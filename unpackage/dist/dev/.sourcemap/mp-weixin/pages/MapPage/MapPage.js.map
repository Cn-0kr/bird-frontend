{"version":3,"file":"MapPage.js","sources":["pages/MapPage/MapPage.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvTWFwUGFnZS9NYXBQYWdlLnZ1ZQ"],"sourcesContent":["<template>\n    <view class=\"container\">\n        <!-- Search Bar -->\n        <view class=\"search-container\">\n            <view class=\"search-box\">\n                <text class=\"icon-search\">üîç</text>\n                <input\n                    type=\"text\"\n                    class=\"search-input\"\n                    placeholder=\"ÊêúÁ¥¢ÁõÆÁöÑÂú∞/È∏üÁ±ªÂêçÁß∞\"\n                    v-model=\"searchText\"\n                    @confirm=\"handleSearch\"\n                />\n            </view>\n        </view>\n\n        <!-- Map Container -->\n        <view class=\"map-container\">\n            <map\n                class=\"map\"\n                :latitude=\"latitude\"\n                :longitude=\"longitude\"\n                :markers=\"markers\"\n                :polyline=\"polyline\"\n                :scale=\"scale\"\n                show-location\n                @markertap=\"onMarkerTap\"\n            ></map>\n\n            <!-- My Location Button -->\n            <view class=\"location-btn\" @tap=\"moveToCurrentLocation\">\n                <text class=\"icon-location\">üìç</text>\n            </view>\n            \n            <!-- Info Card (ÊòæÁ§∫ÁÇπÂáªÂêéÁöÑÂú∞ÁÇπ‰ø°ÊÅØ) -->\n            <view class=\"info-card\" v-if=\"showInfoCard\" @tap.stop=\"showInfoCard = false\">\n                <view class=\"info-card-inner\">\n                    <view class=\"info-card-close\" @tap.stop=\"showInfoCard = false\">√ó</view>\n                    <image class=\"info-card-image\" :src=\"selectedLocation.image\" mode=\"aspectFill\"></image>\n                    <view class=\"info-card-content\">\n                        <view class=\"info-card-title\">{{selectedLocation.name}}</view>\n                        <view class=\"info-card-subtitle\">{{selectedLocation.category}}</view>\n                        <view class=\"info-card-description\">{{selectedLocation.description}}</view>\n                        \n                        <!-- È∏üÁ±ªËßÇÊµãÁªüËÆ° -->\n                        <view class=\"bird-stats\" v-if=\"selectedLocation.birdStats\">\n                            <view class=\"stats-title\">ËßÇÊµãÁªüËÆ°</view>\n                            <view class=\"stats-row\">\n                                <view class=\"stat-item\">\n                                    <text class=\"stat-value\">{{selectedLocation.birdStats.species}}</text>\n                                    <text class=\"stat-label\">È∏üÁßçÊï∞Èáè</text>\n                                </view>\n                                <view class=\"stat-item\">\n                                    <text class=\"stat-value\">{{selectedLocation.birdStats.observations}}</text>\n                                    <text class=\"stat-label\">ËßÇÊµãÊ¨°Êï∞</text>\n                                </view>\n                                <view class=\"stat-item\">\n                                    <text class=\"stat-value\">{{selectedLocation.birdStats.rareSpecies}}</text>\n                                    <text class=\"stat-label\">ÁèçÁ®ÄÈ∏üÁßç</text>\n                                </view>\n                            </view>\n                        </view>\n                        \n                        <!-- Êìç‰ΩúÊåâÈíÆ -->\n                        <view class=\"action-buttons\">\n                            <button class=\"action-btn details-btn\">Êü•ÁúãËØ¶ÊÉÖ</button>\n                            <button class=\"action-btn navigate-btn\">ÂØºËà™ÂâçÂæÄ</button>\n                        </view>\n                    </view>\n                </view>\n            </view>\n        </view>\n        \n        <!-- ÈÅÆÁΩ©Â±Ç - ÂΩì‰ø°ÊÅØÂç°ÁâáÊòæÁ§∫Êó∂ -->\n        <view class=\"overlay\" v-if=\"showInfoCard\" @tap=\"showInfoCard = false\"></view>\n        \r\n<!-- \t\t<view class=\"info-card\" v-if=\"showInfoCard\" style=\"background-color: white; padding: 20px; border: 1px solid black;\">\r\n\t\t  <text>Test InfoCard - ID: {{selectedLocation.id}}</text>\r\n\t\t  <button @tap=\"closeInfoCard\">Close</button>\r\n\t\t</view> -->\r\n\t\t\n        <!-- Ê∑ªÂä†Â∫ïÈÉ®ÂØºËà™Ê†è -->\n        <tab-bar></tab-bar>\n    </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport TabBar from '@/components/tabbar.vue';\n\n// ËÖæËÆØÂú∞ÂõæAPIÂØÜÈí•\nconst TENCENT_MAP_KEY = '2VEBZ-H2SW5-URJIL-I26ZE-2EB2E-BOF27';\n\n// ÂìçÂ∫îÂºèÁä∂ÊÄÅ\nconst latitude = ref(31.2304)  // ÈªòËÆ§Á∫¨Â∫¶Ôºà‰∏äÊµ∑Ôºâ\nconst longitude = ref(121.4737)  // ÈªòËÆ§ÁªèÂ∫¶Ôºà‰∏äÊµ∑Ôºâ\nconst scale = ref(14)  // ÈªòËÆ§Áº©ÊîæÁ∫ßÂà´\nconst searchText = ref('')\nconst markers = ref([])\nconst polyline = ref([]) // Áî®‰∫éÊòæÁ§∫Âå∫ÂüüËæπÁïå\n\n// ‰ø°ÊÅØÂç°ÁâáÁõ∏ÂÖ≥Áä∂ÊÄÅ\nconst showInfoCard = ref(false)\nconst selectedLocation = ref({})\n\n// MockÊï∞ÊçÆ - È∏üÁ±ªËßÇÊµãÁÇπ\nconst birdLocations = [\n    {\n        id: 1,\n        name: 'ÂòâÂÆöÁ¥´Ëó§Âõ≠',\n        category: 'ÊπøÂú∞ÂÖ¨Âõ≠',\n        latitude: 31.2354,\n        longitude: 121.4617,\n        image: '/static/images/location_1.png', // ÈúÄË¶ÅÂáÜÂ§áÂØπÂ∫îÁöÑÂõæÁâá\n        description: 'ÂòâÂÆöÁ¥´Ëó§Âõ≠ÊòØ‰∏äÊµ∑Â∏ÇËëóÂêçÁöÑËßÇÈ∏üÂú∞ÁÇπÔºåÊã•Êúâ‰∏∞ÂØåÁöÑÊπøÂú∞ÁîüÊÄÅÁ≥ªÁªü„ÄÇËøôÈáåÂ∏∏Âπ¥Êúâ20Â§öÁßçÊ∞¥È∏üÊ†ñÊÅØÔºåÊòØËßÇÊµãÂÄôÈ∏üËøÅÂæôÁöÑÁªù‰Ω≥Âú∞ÁÇπ„ÄÇÂõ≠ÂÜÖÊúâ‰∏ìÈó®ÁöÑËßÇÈ∏üÂπ≥Âè∞ÔºåÊØèÂπ¥Êò•Áßã‰∏§Â≠£ÊòØÊúÄ‰Ω≥ËßÇÈ∏üÊó∂Èó¥„ÄÇ',\n        birdStats: {\n            species: 42,\n            observations: 186,\n            rareSpecies: 3\n        }\n    },\n    {\n        id: 2,\n        name: 'Êñ∞ÂüéÂÖ¨Âõ≠',\n        category: 'ÂüéÂ∏ÇÂÖ¨Âõ≠',\n        latitude: 31.2404,\n        longitude: 121.4837,\n        image: '/static/images/location2.jpg',\n        description: 'Êñ∞ÂüéÂÖ¨Âõ≠ÊòØÂ∏ÇÂå∫ÂÜÖÈöæÂæóÁöÑÈ∏üÁ±ªÊ†ñÊÅØÂú∞ÔºåÂÖ¨Âõ≠ÂÜÖÊúâÂ§öÁßç‰πîÊú®ÂíåÁÅåÊú®Ôºå‰∏∫Â∞èÂûãÈ∏üÁ±ªÊèê‰æõ‰∫ÜËâØÂ•ΩÁöÑÊ†ñÊÅØÁéØÂ¢É„ÄÇËøôÈáåÂ∏∏ËßÅÈ∫ªÈõÄ„ÄÅÁôΩÂ§¥Èπé„ÄÅÈªëÂ∞æËú°Âò¥ÈõÄÁ≠âÈ∏üÁ±ªÔºåÊòØÂüéÂ∏Ç‰∏≠ËΩªÊùæËßÇÈ∏üÁöÑÂ•ΩÂéªÂ§Ñ„ÄÇ',\n        birdStats: {\n            species: 18,\n            observations: 94,\n            rareSpecies: 0\n        }\n    },\n    {\n        id: 3,\n        name: 'ÁéØÂüéÊ≤≥ÁªøÂ∏¶',\n        category: 'Ê≤≥ÈÅìÊπøÂú∞',\n        latitude: 31.2284,\n        longitude: 121.4527,\n        image: '/static/images/location3.jpg',\n        description: 'ÁéØÂüéÊ≤≥ÁªøÂ∏¶Ê≤øÁ∫øÊ†ΩÁßç‰∫ÜÂ§ßÈáèÊ∞¥ÁîüÊ§çÁâ©ÔºåÂê∏Âºï‰∫ÜÂ§öÁßçÊ∞¥È∏üÂâçÊù•ËßÖÈ£üÂíåÊ†ñÊÅØ„ÄÇÊ≤≥ËæπËÆæÊúâÂ§ö‰∏™ËßÇÈ∏üÁÇπÔºåÂ∏∏ËßÅÈ∏üÁ±ªÂåÖÊã¨ÁôΩÈπ≠„ÄÅÂ§úÈπ≠„ÄÅÁªøÂ§¥È∏≠Á≠â„ÄÇËøôÈáåÁéØÂ¢ÉÂπΩÈùôÔºåÊòØËßÇÈ∏üÁà±Â•ΩËÄÖÁöÑÁßòÂØÜÂ§©Â†Ç„ÄÇ',\n        birdStats: {\n            species: 26,\n            observations: 132,\n            rareSpecies: 1\n        }\n    },\n    {\n        id: 4,\n        name: 'ÂòâÂÆùËä±Âõ≠Âà´Â¢Ö',\n        category: 'Â±ÖÊ∞ëÂå∫',\n        latitude: 31.2234,\n        longitude: 121.4637,\n        image: '/static/images/location4.jpg',\n        description: 'ÂòâÂÆùËä±Âõ≠Âà´Â¢ÖÂå∫ÂÜÖÁªøÂåñËâØÂ•ΩÔºåÁßçÊ§ç‰∫ÜÂ§öÁßçÊûúÊ†ëÂíåËä±ÂçâÔºåÂê∏Âºï‰∫ÜÂæàÂ§öÂ∞èÂûãÈ∏üÁ±ªÂâçÊù•Á≠ëÂ∑¢„ÄÇËøôÈáåÂèØ‰ª•ËßÇÂØüÂà∞Êü≥Ëé∫„ÄÅÁª£ÁúºÈ∏üÁ≠âÂ∞èÂûãÈ∏üÁ±ªÔºåÊòØÂüéÂ∏ÇËßÇÈ∏üÁöÑÂ•ΩÂéªÂ§Ñ„ÄÇÊ≠§Â§Ñ‰∏∫Â±ÖÊ∞ëÂå∫ÔºåÂèÇËßÇÊó∂ËØ∑‰øùÊåÅÂÆâÈùô„ÄÇ',\n        birdStats: {\n            species: 13,\n            observations: 67,\n            rareSpecies: 0\n        }\n    },\n    {\n        id: 5,\n        name: 'Ê¢¶Ëä±Êπñ',\n        category: 'ÊπñÊ≥äÊπøÂú∞',\n        latitude: 31.2454,\n        longitude: 121.4557,\n        image: '/static/images/location5.jpg',\n        description: 'Ê¢¶Ëä±ÊπñÊòØ‰∏Ä‰∏™‰∫∫Â∑•ÊπñÊ≥äÔºåÂë®Âõ¥Ê§çË¢´ËåÇÁõõÔºåÊπñÈù¢ÂºÄÈòîÔºåÊòØÂ§öÁßçÊ∞¥È∏üÂíåÊ∂âÁ¶ΩÁöÑÊ†ñÊÅØÂú∞„ÄÇËøôÈáåÂèØ‰ª•ËßÇÂØüÂà∞ÁôΩÈπ≠„ÄÅËãçÈπ≠„ÄÅÂ∞è‰¥ô‰¥òÁ≠âÊ∞¥È∏üÔºå‰ª•ÂèäÂ§öÁßçÈõÅÈ∏≠Á±ª„ÄÇÊπñËæπÊúâ‰∏ìÈó®ÁöÑËßÇÈ∏üÂ±ãÂíåÊ†àÈÅìÔºåÈÄÇÂêàÈïøÊó∂Èó¥ËßÇÈ∏ü„ÄÇ',\n        birdStats: {\n            species: 35,\n            observations: 158,\n            rareSpecies: 2\n        }\n    },\n    {\n        id: 6,\n        name: 'ÂûÉÂúæÂ°´ÂüãÂú∫ÊπøÂú∞',\n        category: 'ÊÅ¢Â§çÊÄßÊπøÂú∞',\n        latitude: 31.2194,\n        longitude: 121.4867,\n        image: '/static/images/location6.jpg',\n        description: 'Ëøô‰∏™Âå∫ÂüüÂéüÊòØÂûÉÂúæÂ°´ÂüãÂú∫ÔºåÂêéÁªèËøáÁîüÊÄÅ‰øÆÂ§çÔºåÁé∞Â∑≤Êàê‰∏∫ÈáçË¶ÅÁöÑÈ∏üÁ±ªÊ†ñÊÅØÂú∞„ÄÇÁî±‰∫éÊòÜËô´ÂíåÂ∞èÂûãÂä®Áâ©‰∏∞ÂØåÔºåÂê∏Âºï‰∫ÜÂ§ßÈáèÁåõÁ¶ΩÂíåÊ∂âÁ¶Ω„ÄÇËøôÈáåÂ∏∏ËßÅÁåõÁ¶ΩÂåÖÊã¨Á∫¢Èöº„ÄÅÊôÆÈÄöÈµüÁ≠âÔºåÊòØËßÇÂØüÁåõÁ¶ΩÁöÑÁêÜÊÉ≥Âú∫ÊâÄ„ÄÇ',\n        birdStats: {\n            species: 22,\n            observations: 76,\n            rareSpecies: 2\n        }\n    },\n    {\n        id: 7,\n        name: 'ÁªøÂú∞ÂòâÂ∞öÂõΩÈôÖÂπøÂú∫',\n        category: 'ÂüéÂ∏ÇÁªøÂú∞',\n        latitude: 31.2284,\n        longitude: 121.4987,\n        image: '/static/images/location7.jpg',\n        description: 'ÁªøÂú∞ÂòâÂ∞öÂõΩÈôÖÂπøÂú∫Âë®ËæπÊúâÁ≤æÂøÉËÆæËÆ°ÁöÑÂüéÂ∏ÇÁªøÂú∞ÔºåÁßçÊ§ç‰∫ÜÂ§öÁßç‰π°ÂúüÊ†ëÁßçÔºå‰∏∫È∏üÁ±ªÊèê‰æõ‰∫ÜËâØÂ•ΩÁöÑÊ†ñÊÅØÁéØÂ¢É„ÄÇËøôÈáåÂ∏∏ËßÅÈ∏üÁ±ªÂåÖÊã¨Áè†È¢àÊñëÈ∏†„ÄÅÊ†ëÈ∫ªÈõÄ„ÄÅÁôΩÂ§¥ÈπéÁ≠âÔºåÈÄÇÂêàÊó©Êô®ÊàñÂÇçÊôöÂâçÊù•ËßÇÈ∏ü„ÄÇ',\n        birdStats: {\n            species: 16,\n            observations: 83,\n            rareSpecies: 0\n        }\n    }\n];\n\n// Ê£ÄÊü•Âπ∂Ëé∑Âèñ‰ΩçÁΩÆÊùÉÈôê\nconst checkAndRequestLocationPermission = () => {\n    return new Promise((resolve, reject) => {\n        uni.getSetting({\n            success: (res) => {\n                if (res.authSetting['scope.userLocation'] === false) {\n                    // Áî®Êà∑Â∑≤ÊãíÁªùËøáÊéàÊùÉÔºåÊòæÁ§∫ÂºïÂØºÂºπÁ™ó\n                    uni.showModal({\n                        title: 'ÈúÄË¶Å‰ΩçÁΩÆÊùÉÈôê',\n                        content: '‰∏∫‰∫ÜÊèê‰æõÂáÜÁ°ÆÁöÑÂú∞ÂõæÊúçÂä°ÔºåÈúÄË¶ÅËé∑ÂèñÊÇ®ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ„ÄÇËØ∑Âú®ËÆæÁΩÆ‰∏≠ÂÖÅËÆ∏\"‰∫ëÈõÄËß£Á†Å\"ËÆøÈóÆÊÇ®ÁöÑ‰ΩçÁΩÆ„ÄÇ',\n                        confirmText: 'ÂéªËÆæÁΩÆ',\n                        cancelText: 'ÂèñÊ∂à',\n                        success: (modalRes) => {\n                            if (modalRes.confirm) {\n                                // ÊâìÂºÄËÆæÁΩÆÈ°µÈù¢\n                                uni.openSetting({\n                                    success: (settingRes) => {\n                                        if (settingRes.authSetting['scope.userLocation']) {\n                                            resolve();\n                                        } else {\n                                            reject(new Error('Êú™Ëé∑Âæó‰ΩçÁΩÆÊùÉÈôê'));\n                                        }\n                                    }\n                                });\n                            } else {\n                                reject(new Error('Áî®Êà∑ÂèñÊ∂àÊéàÊùÉ'));\n                            }\n                        }\n                    });\n                } else if (res.authSetting['scope.userLocation'] === true) {\n                    // Áî®Êà∑Â∑≤ÊéàÊùÉ\n                    resolve();\n                } else {\n                    // È¶ñÊ¨°ËØ∑Ê±ÇÊéàÊùÉ\n                    uni.authorize({\n                        scope: 'scope.userLocation',\n                        success: () => {\n                            resolve();\n                        },\n                        fail: (err) => {\n                            reject(err);\n                        }\n                    });\n                }\n            },\n            fail: (err) => {\n                reject(err);\n            }\n        });\n    });\n};\n\n// Ëé∑ÂèñÂΩìÂâç‰ΩçÁΩÆ\nconst getCurrentLocation = () => {\n    // ÊòæÁ§∫Âä†ËΩΩÊèêÁ§∫\n    uni.showLoading({\n        title: 'ÂÆö‰Ωç‰∏≠...'\n    });\n\n    // ÂÖàÊ£ÄÊü•ÊùÉÈôê\n    checkAndRequestLocationPermission()\n        .then(() => {\n            // Ëé∑Âèñ‰ΩçÁΩÆ\n            uni.getLocation({\n                type: 'gcj02',\n                success: (res) => {\n                    latitude.value = res.latitude;\n                    longitude.value = res.longitude;\n                    scale.value = 16; // ÊîæÂ§ßÂú∞Âõæ‰ª•Êõ¥Ê∏ÖÊô∞Âú∞ÊòæÁ§∫‰ΩçÁΩÆ\n\n                    uni.showToast({\n                        title: 'ÂÆö‰ΩçÊàêÂäü',\n                        icon: 'success',\n                        duration: 1500\n                    });\n\n                    // Âä†ËΩΩÈ∏üÁ±ªËßÇÊµãÁÇπÊï∞ÊçÆ\n                    loadBirdLocations();\n                },\n                fail: (err) => {\n                    console.error('Ëé∑Âèñ‰ΩçÁΩÆÂ§±Ë¥•Ôºö', err);\n                    uni.showToast({\n                        title: 'Ëé∑Âèñ‰ΩçÁΩÆÂ§±Ë¥•',\n                        icon: 'none'\n                    });\n                    \n                    // Âç≥‰ΩøËé∑Âèñ‰ΩçÁΩÆÂ§±Ë¥•Ôºå‰πüÂä†ËΩΩÈ∏üÁ±ªËßÇÊµãÁÇπÊï∞ÊçÆ\n                    loadBirdLocations();\n                },\n                complete: () => {\n                    uni.hideLoading();\n                }\n            });\n        })\n        .catch((err) => {\n            console.error('‰ΩçÁΩÆÊùÉÈôêÈîôËØØÔºö', err);\n            uni.hideLoading();\n            \n            // ‰ΩøÁî®ÈªòËÆ§‰ΩçÁΩÆÂä†ËΩΩÊï∞ÊçÆ\n            loadBirdLocations();\n        });\n};\n\n// ÁßªÂä®Âà∞ÂΩìÂâç‰ΩçÁΩÆ\nconst moveToCurrentLocation = () => {\n    getCurrentLocation();\n};\n\n// ‰ΩøÁî®ËÖæËÆØÂú∞ÂõæAPIËøõË°åÂú∞ÁÇπÊêúÁ¥¢\nconst searchLocation = (keyword) => {\n    return new Promise((resolve, reject) => {\n        uni.request({\n            url: `https://apis.map.qq.com/ws/place/v1/search`,\n            method: 'GET',\n            data: {\n                key: TENCENT_MAP_KEY,\n                keyword: keyword,\n                boundary: 'nearby(' + latitude.value + ',' + longitude.value + ',10000)', // ÊêúÁ¥¢ËåÉÂõ¥10km\n                page_size: 10,\n                page_index: 1\n            },\n            success: (res) => {\n                if (res.data && res.data.status === 0 && res.data.data.length > 0) {\n                    resolve(res.data.data);\n                } else {\n                    reject(new Error('Êú™ÊâæÂà∞Áõ∏ÂÖ≥Âú∞ÁÇπ'));\n                }\n            },\n            fail: (err) => {\n                reject(err);\n            }\n        });\n    });\n};\n\n// Â§ÑÁêÜÊêúÁ¥¢\nconst handleSearch = async () => {\n    if (!searchText.value) return;\n    \n    uni.showLoading({ title: 'ÊêúÁ¥¢‰∏≠...' });\n    \n    try {\n        const result = await searchLocation(searchText.value);\n        if (result && result.length > 0) {\n            // Êõ¥Êñ∞Âú∞Âõæ‰∏≠ÂøÉÁÇπ\n            latitude.value = result[0].location.lat;\n            longitude.value = result[0].location.lng;\n            \n            // Ê∑ªÂä†ÊêúÁ¥¢ÁªìÊûúÊ†áËÆ∞Ôºå‰ΩøÁî®‰∏çÂêåÈ¢úËâ≤Âå∫ÂàÜÊêúÁ¥¢ÁªìÊûúÂíåÊï∞ÊçÆÂ∫ìÂú∞ÁÇπ\n            const searchMarker = {\n                id: 999,\n                latitude: result[0].location.lat,\n                longitude: result[0].location.lng,\n                title: result[0].title,\n                iconPath: '/static/images/location-pin-solid.svg', // Á∫¢Ëâ≤Ê†áËÆ∞ÂõæÊ†á\n                width: 30,\n                height: 30,\n                callout: {\n                    content: result[0].title,\n                    color: '#000000',\n                    fontSize: 12,\n                    borderRadius: 5,\n                    bgColor: '#ffffff',\n                    padding: 5,\n                    display: 'ALWAYS'\n                }\n            };\n            \n            // ‰øùÁïôÊï∞ÊçÆÂ∫ìÂú∞ÁÇπÊ†áËÆ∞Âπ∂Ê∑ªÂä†ÊêúÁ¥¢ÁªìÊûúÊ†áËÆ∞\n            const dbMarkers = markers.value.filter(marker => marker.id !== 999);\n            markers.value = [...dbMarkers, searchMarker];\n            \n            scale.value = 16; // ÊîæÂ§ßÂú∞Âõæ‰ª•Êõ¥Ê∏ÖÊô∞Âú∞ÊòæÁ§∫‰ΩçÁΩÆ\n        }\n    } catch (error) {\n        uni.showToast({\n            title: 'ÊêúÁ¥¢Â§±Ë¥•: ' + error.message,\n            icon: 'none'\n        });\n    } finally {\n        uni.hideLoading();\n    }\n};\n\n// Âä†ËΩΩÈ∏üÁ±ªËßÇÊµãÁÇπÊï∞ÊçÆ\nconst loadBirdLocations = () => {\n    // ËøôÈáå‰ΩøÁî®MockÊï∞ÊçÆÔºåÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫îËØ•‰ªéAPIËé∑Âèñ\n    const locationMarkers = birdLocations.map(loc => ({\n        id: loc.id,\n        latitude: loc.latitude,\n        longitude: loc.longitude,\n        title: loc.name,\n        iconPath: '/static/images/location-pin-solid.svg', // ÁªøËâ≤Ê†áËÆ∞ÂõæÊ†á\n        width: 30,\n        height: 30,\n        callout: {\n            content: loc.name,\n            color: '#000000',\n            fontSize: 12,\n            borderRadius: 5,\n            bgColor: '#ffffff',\n            padding: 5,\n            display: 'AlWAYS'\n        }\n    }));\n    \n    // Êõ¥Êñ∞Ê†áËÆ∞\n    markers.value = locationMarkers;\n    \n    // ÁªòÂà∂Âå∫ÂüüËæπÁïå\n    drawAreaBoundary(birdLocations);\n};\n\n// ÁªòÂà∂Âå∫ÂüüËæπÁïå\nconst drawAreaBoundary = (locations) => {\n    if (locations.length < 3) return; // Ëá≥Â∞ëÈúÄË¶Å3‰∏™ÁÇπÊâçËÉΩÂΩ¢Êàê‰∏Ä‰∏™Âå∫Âüü\n    \n    // ‰ΩøÁî®ÊâÄÊúâÁÇπÊûÑÂª∫‰∏Ä‰∏™Â§öËæπÂΩ¢\n    const points = locations.map(loc => ({\n        latitude: loc.latitude,\n        longitude: loc.longitude\n    }));\n    \n    // Ê∑ªÂä†Á¨¨‰∏Ä‰∏™ÁÇπ‰Ωú‰∏∫ÁªìÊùüÁÇπÔºåÂΩ¢ÊàêÈó≠ÁéØ\n    points.push(points[0]);\n    \n    polyline.value = [{\n        points: points,\n        color: '#1E90FF77', // ÂçäÈÄèÊòéËìùËâ≤\n        width: 2,\n        dottedLine: false,\n        arrowLine: false\n    }];\n};\n\n// Â§ÑÁêÜÊ†áËÆ∞ÁÇπÂáª‰∫ã‰ª∂\nconst onMarkerTap = (e) => {\n    console.log('Marker tapped:', e); // Ê∑ªÂä†Êó•Âøó‰ª•‰æøË∞ÉËØï\n    const markerId = e.detail.markerId; // Ê≥®ÊÑèÔºö‰ΩøÁî® e.detail.markerId ËÄå‰∏çÊòØ e.markerId\n    \n    console.log('Looking for location with ID:', markerId);\n    // Êü•ÊâæË¢´ÁÇπÂáªÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ\n    const location = birdLocations.find(loc => loc.id === markerId);\n    \n    if (location) {\n        console.log('Found location:', location);\n        // ËÆæÁΩÆÈÄâ‰∏≠ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ\n        selectedLocation.value = location;\n        // ÊòæÁ§∫‰ø°ÊÅØÂç°Áâá\n        showInfoCard.value = true;\n    } else {\n        console.log('No matching location found for ID:', markerId);\n        // ÂèØ‰ª•Ê∑ªÂä†‰∏Ä‰∏™ÊèêÁ§∫ÔºåÂ¶ÇÊûúÈúÄË¶Å\n        uni.showToast({\n            title: 'Êú™ÊâæÂà∞ËØ•Âú∞ÁÇπ‰ø°ÊÅØ',\n            icon: 'none'\n        });\n    }\n};\n// È°µÈù¢Âä†ËΩΩÊó∂Ëé∑Âèñ‰ΩçÁΩÆÂíåÂä†ËΩΩÊï∞ÊçÆ\nonMounted(() => {\n    getCurrentLocation();\n});\n</script>\n\n<style>\n.container {\n    position: relative;\n    height: 100vh;\n    background-color: #fffbeb;\n}\n\n.search-container {\n    position: fixed;\n    top: var(--status-bar-height);\n    left: 0;\n    right: 0;\n    z-index: 100;\n    padding: 20rpx;\n}\n\n.search-box {\n    display: flex;\n    align-items: center;\n    background-color: #ffffff;\n    border-radius: 100rpx;\n    padding: 16rpx 30rpx;\n    box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n.icon-search {\n    margin-right: 16rpx;\n    font-size: 32rpx;\n    color: #666;\n}\n\n.search-input {\n    flex: 1;\n    font-size: 28rpx;\n    color: #333;\n}\n\n.map-container {\n    position: relative;\n    height: 100%;\n    width: 100%;\n}\n\n.map {\n    width: 100%;\n    height: 100%;\n}\n\n.location-btn {\n    position: fixed;\n    right: 30rpx;\n    bottom: 120rpx;\n    background-color: #ffffff;\n    width: 80rpx;\n    height: 80rpx;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.1);\n    z-index: 100;\n}\n\n.icon-location {\n    font-size: 40rpx;\n}\n\n/* Ê∑ªÂä†ÁÇπÂáªÊïàÊûú */\n.location-btn:active {\n    opacity: 0.8;\n    transform: scale(0.95);\n}\n\n/* ÈÅÆÁΩ©Â±Ç */\n.overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 200;\n}\n\n/* ‰ø°ÊÅØÂç°ÁâáÊ†∑Âºè */\n.info-card {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 300;\n    padding: 30rpx;\n    padding-bottom: calc(30rpx + env(safe-area-inset-bottom));\n}\n\n.info-card-inner {\n    background-color: #ffffff;\n    border-radius: 24rpx;\n    overflow: hidden;\n    box-shadow: 0 4rpx 30rpx rgba(0, 0, 0, 0.15);\n    position: relative;\n    max-height: 80vh;\n    overflow-y: auto;\n}\n\n.info-card-close {\n    position: absolute;\n    top: 20rpx;\n    right: 20rpx;\n    width: 60rpx;\n    height: 60rpx;\n    background-color: rgba(0, 0, 0, 0.5);\n    color: #ffffff;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 36rpx;\n    z-index: 10;\n}\n\n.info-card-image {\n    width: 100%;\n    height: 320rpx;\n    object-fit: cover;\n}\n\n.info-card-content {\n    padding: 30rpx;\n}\n\n.info-card-title {\n    font-size: 36rpx;\n    font-weight: bold;\n    color: #333;\n    margin-bottom: 10rpx;\n}\n\n.info-card-subtitle {\n    font-size: 24rpx;\n    color: #666;\n    margin-bottom: 20rpx;\n}\n\n.info-card-description {\n    font-size: 28rpx;\n    color: #333;\n    line-height: 1.6;\n    margin-bottom: 30rpx;\n}\n\n/* È∏üÁ±ªÁªüËÆ°Ê†∑Âºè */\n.bird-stats {\n    background-color: #f8f8f8;\n    border-radius: 16rpx;\n    padding: 20rpx;\n    margin-bottom: 30rpx;\n}\n\n.stats-title {\n    font-size: 28rpx;\n    font-weight: bold;\n    color: #333;\n    margin-bottom: 20rpx;\n}\n\n.stats-row {\n    display: flex;\n    justify-content: space-between;\n}\n\n.stat-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    flex: 1;\n}\n\n.stat-value {\n    font-size: 32rpx;\n    font-weight: bold;\n    color: #07c160;\n}\n\n.stat-label {\n    font-size: 24rpx;\n    color: #666;\n    margin-top: 10rpx;\n}\n\n/* Êìç‰ΩúÊåâÈíÆ */\n.action-buttons {\n    display: flex;\n    gap: 20rpx;\n}\n\n.action-btn {\n    flex: 1;\n    height: 80rpx;\n    border-radius: 40rpx;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 28rpx;\n    border: none;\n}\n\n.details-btn {\n    background-color: #f0f0f0;\n    color: #333;\n}\n\n.navigate-btn {\n    background-color: #07c160;\n    color: #ffffff;\n}\n</style>","import MiniProgramPage from 'D:/sitpÈ°πÁõÆ/miniprogram/bird-frontend/pages/MapPage/MapPage.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onMounted","MiniProgramPage"],"mappings":"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"}