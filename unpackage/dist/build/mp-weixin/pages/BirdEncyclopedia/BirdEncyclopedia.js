"use strict";const e=require("../../common/vendor.js");Math||a();const a=()=>"../../components/BirdKnowledgeCard.js",t={__name:"BirdEncyclopedia",setup(a){const t=e.ref("search"),i=e.ref(""),s=e.ref(!1),l=e.ref([]),n=e.ref(0),u=e.ref([]),c="https://birdfront-oss.oss-cn-shanghai.aliyuncs.com",o=(e,a="icon")=>{if(!e)return"";const t=e.startsWith("/")?e.slice(1):e;let i="";switch(a){case"icon":default:i="?x-oss-process=image/resize,m_lfit,w_48,h_48/quality,q_90";break;case"small-icon":i="?x-oss-process=image/resize,m_lfit,w_32,h_32/quality,q_90";break;case"medium":i="?x-oss-process=image/resize,m_lfit,w_200,h_200/quality,q_85";break;case"large":i="?x-oss-process=image/resize,m_lfit,w_120,h_120/quality,q_90";break;case"bird-image":i="?x-oss-process=image/resize,m_lfit,w_600,h_400/quality,q_85"}return`${c}/${t}${i}`},r=e.ref(!1),v=e.ref(0),h=e.ref(0),d=e.ref(0),m=e.ref(1),g=e.ref(1),p=e.ref(.95),f=e.ref(.7),b=[{id:1,name:"巨嘴鸟",scientificName:"Ramphastos sulfuratus",imageUrl:"static/birds/toucan.jpg",tags:["热带鸟类","彩色","大型"],habitat:"热带雨林",size:"体长50-65cm",weight:"500-860克",wingspan:"109-152cm",diet:"主要以果实为食，偶尔捕食小型动物",behavior:"群居性鸟类，善于飞行和攀爬",distribution:"中美洲和南美洲的热带雨林",conservationStatus:"无危",characteristics:["拥有巨大而彩色的喙","羽毛色彩鲜艳","飞行能力强","社交性强"],funFacts:["巨嘴鸟的大喙实际上很轻，内部充满了气囊","它们的喙可以占到身体长度的1/3","巨嘴鸟睡觉时会将喙折叠到背上"],callDescription:"发出低沉的咕咕声和尖锐的叫声",nestingHabits:"在树洞中筑巢，每次产卵2-4枚",lifespan:"野外约15-20年"},{id:2,name:"蜂鸟",scientificName:"Trochilidae",imageUrl:"static/birds/hummingbird.jpg",tags:["小型鸟类","快速","悬停"],habitat:"花园、森林边缘",size:"体长5-25cm",weight:"2-20克",wingspan:"5-25cm",diet:"花蜜、小昆虫",behavior:"能够悬停飞行，翅膀拍打频率极高",distribution:"南北美洲",conservationStatus:"大多数种类稳定",characteristics:["世界上最小的鸟类","能够悬停和倒飞","心跳频率极快","新陈代谢旺盛"],funFacts:["蜂鸟的翅膀每秒可拍打80次","它们的心跳每分钟可达1260次","蜂鸟可以倒着飞行","它们的舌头比喙还要长"],callDescription:"发出细小的吱吱声",nestingHabits:"建造精巧的杯状巢，每次产卵1-3枚",lifespan:"野外约3-5年"},{id:3,name:"孔雀",scientificName:"Pavo cristatus",imageUrl:"static/birds/peacock.jpg",tags:["大型鸟类","华丽","地栖"],habitat:"森林、公园、农田",size:"体长100-115cm",weight:"4-6公斤",wingspan:"120-160cm",diet:"种子、昆虫、小型爬行动物",behavior:"雄鸟会展开尾羽进行求偶炫耀",distribution:"南亚、东南亚",conservationStatus:"无危",characteristics:["雄鸟有华丽的尾羽","能够短距离飞行","叫声洪亮","具有强烈的领域性"],funFacts:["孔雀的尾羽可以长达1.5米",'尾羽上的眼斑叫做"眼状斑"',"孔雀实际上可以飞行，但不擅长长距离飞行",'雌孔雀被称为"孔雀雌"'],callDescription:"发出尖锐的叫声，特别是在求偶季节",nestingHabits:"在地面筑巢，每次产卵3-5枚",lifespan:"野外约15-20年"},{id:4,name:"老鹰",scientificName:"Aquila chrysaetos",imageUrl:"static/birds/eagle.jpg",tags:["猛禽","大型","捕食者"],habitat:"山地、草原、森林",size:"体长75-100cm",weight:"3-7公斤",wingspan:"180-280cm",diet:"小型哺乳动物、鸟类、鱼类",behavior:"优秀的猎手，视力极佳",distribution:"全球各大洲（除南极洲）",conservationStatus:"部分种类濒危",characteristics:["视力是人类的8倍","强有力的爪子和喙","飞行能力极强","领域性强"],funFacts:["老鹰可以从3公里外发现猎物","它们的俯冲速度可达每小时300公里","老鹰可以活到30岁以上","许多文化将老鹰视为力量和自由的象征"],callDescription:"发出尖锐的啸叫声",nestingHabits:"在高处筑大型巢穴，每次产卵1-3枚",lifespan:"野外约20-30年"}],w=e.computed((()=>{const e=parseInt(n.value)||0,a=parseInt(u.value.length)||0;return 0===a?0:Math.max(0,Math.min(e,a-1))})),x=e.computed((()=>parseInt(u.value.length)||0)),_=e.computed((()=>w.value+1)),I=e.computed((()=>w.value>0&&!r.value&&x.value>0)),y=e.computed((()=>w.value<x.value-1&&!r.value&&x.value>0)),M=e.computed((()=>({transform:`translateY(${d.value}px) scale(${g.value})`,opacity:m.value,zIndex:10}))),q=e.computed((()=>({transform:`scale(${p.value})`,opacity:f.value,zIndex:5}))),z=e=>{r.value||(v.value=e.touches[0].clientY,h.value=e.touches[0].clientY)},k=e=>{if(r.value||0===u.value.length)return;h.value=e.touches[0].clientY;const a=h.value-v.value,t=parseInt(n.value)||0,i=parseInt(u.value.length)||0;if(a<0&&t<i-1){const e=Math.min(Math.abs(a)/200,1);d.value=a,m.value=1-.7*e,g.value=1-.1*e,p.value=.95+.05*e,f.value=.7+.3*e}},S=e=>{if(r.value||0===u.value.length)return;h.value-v.value<-100&&n.value<u.value.length-1?D():T()},T=()=>{d.value=0,m.value=1,g.value=1,p.value=.95,f.value=.7},$=()=>{e.index.navigateBack()},j=()=>{t.value="search"===t.value?"general":"search",e.index.vibrateShort(),"general"===t.value&&0===u.value.length&&Y()},N=()=>{i.value.trim()?P():l.value=[]},B=()=>{i.value.trim()&&P()},C=()=>{i.value="",l.value=[]},U=()=>{const e=parseInt(n.value)||0,a=parseInt(u.value.length)||0;e>0&&!r.value&&a>0&&(r.value=!0,d.value=50,m.value=0,setTimeout((()=>{const a=Math.max(0,e-1);n.value=a,T(),r.value=!1}),300))},D=()=>{const a=parseInt(n.value)||0,t=parseInt(u.value.length)||0;a<t-1&&!r.value&&t>0&&(r.value=!0,d.value=-200,m.value=0,g.value=.8,setTimeout((()=>{const e=Math.min(t-1,a+1);n.value=e,T(),r.value=!1}),300),e.index.vibrateShort())},F=a=>{e.index.showToast({title:"已收藏",icon:"success"})},H=a=>{e.index.showShareMenu({title:`分享鸟类：${a.name}`,path:`/pages/BirdEncyclopedia/BirdEncyclopedia?birdId=${a.id}`})},P=async()=>{try{s.value=!0,await new Promise((e=>setTimeout(e,300)));const e=i.value.toLowerCase(),a=b.filter((a=>a.name.toLowerCase().includes(e)||a.scientificName.toLowerCase().includes(e)||a.tags.some((a=>a.includes(e)))||a.habitat.includes(e)));l.value=a}catch(a){console.error("搜索失败:",a),e.index.showToast({title:"搜索失败",icon:"error"})}finally{s.value=!1}},Y=()=>{u.value=[...b],n.value=0,T()},E=async()=>{try{u.value=[...b]}catch(a){console.error("加载数据失败:",a),e.index.showToast({title:"加载失败",icon:"error"})}},L=e=>{console.warn("图标加载失败:",e)},A=e=>{console.warn("图片加载失败:",e)};return e.watch([u,n],(([e,a])=>{const t=parseInt(e.length)||0,i=parseInt(a)||0;if(t>0){const e=Math.max(0,Math.min(i,t-1));e!==i&&(n.value=e)}else n.value=0}),{deep:!0}),e.onMounted((async()=>{const e=getCurrentPages(),a=e[e.length-1].options||{};if(a.birdId){t.value="general",await E();const e=parseInt(a.birdId),i=u.value.findIndex((a=>a.id===e));-1!==i&&(n.value=Math.max(0,Math.min(i,u.value.length-1)))}else await E();T(),u.value.length>0&&(n.value=Math.max(0,Math.min(n.value,u.value.length-1)))})),(a,c)=>e.e({a:o("static/icons/back.png","icon"),b:e.o(L),c:e.o($),d:o("search"===t.value?"static/icons/book.png":"static/icons/search.png","icon"),e:e.o(L),f:e.o(j),g:"general"===t.value?1:"",h:"search"===t.value},"search"===t.value?e.e({i:o("static/icons/search.png","icon"),j:e.o(L),k:e.o([e=>i.value=e.detail.value,N]),l:e.o(B),m:i.value,n:i.value},i.value?{o:o("static/icons/close.png","small-icon"),p:e.o(L),q:e.o(C)}:{},{r:s.value},s.value?{}:l.value.length>0?{t:e.f(l.value,((a,s,c)=>({a:o(a.imageUrl,"medium"),b:e.o(A,a.id),c:e.t(a.name),d:e.t(a.scientificName),e:e.f(a.tags,((a,t,i)=>({a:e.t(a),b:a}))),f:a.id,g:e.o((e=>(e=>{t.value="general";const a=u.value.findIndex((a=>a.id===e.id));-1!==a&&(n.value=parseInt(a)),i.value="",l.value=[],T()})(a)),a.id),h:.1*s+"s"})))}:i.value&&!s.value?{w:o("static/icons/no-search-results.png","large"),x:e.o(L)}:{y:o("static/icons/search-placeholder.png","large"),z:e.o(L)},{s:l.value.length>0,v:i.value&&!s.value}):e.e({A:e.t(_.value),B:e.t(x.value),C:(x.value>0?_.value/x.value*100:0)+"%",D:w.value<x.value-1&&x.value>1},w.value<x.value-1&&x.value>1?{E:e.o(F),F:e.o(H),G:e.p({"bird-data":u.value[w.value+1],"is-active":!1}),H:e.s(q.value)}:{},{I:x.value>0&&u.value[w.value]},x.value>0&&u.value[w.value]?{J:e.o(F),K:e.o(H),L:e.p({"bird-data":u.value[w.value],"is-active":!0}),M:e.s(M.value),N:r.value?1:""}:{},{O:e.o(z),P:e.o(k),Q:e.o(S),R:o("static/icons/swipe-up.png","small-icon"),S:e.o(L),T:o("static/icons/tap.png","small-icon"),U:e.o(L),V:r.value?1:"",W:o("static/icons/prev.png","small-icon"),X:e.o(L),Y:I.value?"":1,Z:e.o(U),aa:e.t(_.value),ab:e.t(x.value),ac:o("static/icons/next.png","small-icon"),ad:e.o(L),ae:y.value?"":1,af:e.o(D)}))}},i=e._export_sfc(t,[["__scopeId","data-v-dee1c311"]]);wx.createPage(i);
