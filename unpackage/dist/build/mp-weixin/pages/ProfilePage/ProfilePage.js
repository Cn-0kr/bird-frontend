"use strict";const e=require("../../common/vendor.js"),t=new(require("../../api/services/user.js").UserService),s={components:{HomePoster:()=>"../../components/homeposter.js",TabBar:()=>"../../components/tabbar.js"},data:()=>({isLoading:!1,activeTab:"posts",ossConfig:{baseUrl:"https://birdfront-oss.oss-cn-shanghai.aliyuncs.com",defaultParams:"?x-oss-process=image/resize,m_lfit,w_300,h_300/quality,q_80"},userInfo:{avatar:"static/default-avatar.png",nickname:"鸟类爱好者",bio:"",postsCount:0,likesCount:0,level:1},achievements:[{id:1,name:"初级观鸟员",icon:"static/icons/achievements/beginner.png"},{id:2,name:"摄影新手",icon:"static/icons/achievements/photographer.png"}],posts:[],likes:[],records:[],leftColumn:[],rightColumn:[]}),computed:{currentContent(){switch(this.activeTab){case"posts":return this.posts;case"likes":return this.likes;case"records":return this.records;default:return[]}},userAvatarUrl(){return this.getOSSUrl(this.userInfo.avatar,"small")},editIconUrl(){return this.getOSSUrl("static/icons/edit.png","icon")}},async onLoad(){await this.loadUserInfo(),this.loadContent()},methods:{getOSSUrl(e,t="medium"){if(!e)return`${this.ossConfig.baseUrl}/static/default-avatar.png${this.ossConfig.defaultParams}`;const s=e.startsWith("/")?e.slice(1):e;let i="";switch(t){case"icon":i="?x-oss-process=image/resize,m_lfit,w_50,h_50/quality,q_90";break;case"small":i="?x-oss-process=image/resize,m_lfit,w_150,h_150/quality,q_90";break;case"medium":i="?x-oss-process=image/resize,m_lfit,w_300,h_300/quality,q_80";break;case"large":i="?x-oss-process=image/resize,m_lfit,w_600,h_600/quality,q_85"}return`${this.ossConfig.baseUrl}/${s}${i}`},async loadUserInfo(){try{const e=await t.getIntro();this.userInfo.bio=e||"点击添加个人介绍..."}catch(s){console.error("Failed to load user info:",s),e.index.showToast({title:"加载个人信息失败",icon:"none"})}},handleAvatarClick(){e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async t=>{try{this.userInfo.avatar=`avatars/user_${Date.now()}.jpg`,e.index.showToast({title:"头像更新成功",icon:"success"})}catch(s){console.error("头像上传失败:",s),e.index.showToast({title:"头像上传失败",icon:"none"})}}})},handleAvatarError(){console.warn("头像加载失败，使用默认头像"),this.userInfo.avatar="static/default-avatar.png"},handleEditProfile(){e.index.navigateTo({url:"/pages/EditProfile/EditProfile"})},handleEditBio(){e.index.showModal({title:"编辑个人介绍",editable:!0,content:"点击添加个人介绍..."===this.userInfo.bio?"":this.userInfo.bio,success:e=>{e.confirm&&this.updateBio(e.content)}})},async updateBio(t){try{this.userInfo.bio=t||"点击添加个人介绍...",e.index.showToast({title:"更新成功",icon:"success"})}catch(s){console.error("Failed to update bio:",s),e.index.showToast({title:"更新失败",icon:"none"})}},switchTab(e){this.activeTab!==e&&(this.activeTab=e,this.loadContent())},async loadContent(){this.isLoading=!0;try{let e;switch(await new Promise((e=>setTimeout(e,500))),this.activeTab){case"posts":e=[{id:1,imageUrl:"static/posts/bird1.jpg",imageHeight:200,description:"今天拍到的小鸟",views:1234,likes:88}],this.posts=e;break;case"likes":e=[{id:2,imageUrl:"static/posts/bird2.jpg",imageHeight:280,description:"好漂亮的鸟儿！",views:2567,likes:189}],this.likes=e;break;case"records":e=[{id:3,imageUrl:"static/recognition/bird1.jpg",imageHeight:240,description:"识别结果：红头长尾山雀",accuracy:"98%",date:"2024-03-20"},{id:5,imageUrl:"static/recognition/bird2.jpg",imageHeight:220,description:"识别结果：白头硬尾鹎",accuracy:"97%",date:"2024-03-18"}],this.records=e}this.distributeContent()}catch(t){console.error("Load content error:",t),e.index.showToast({title:"加载失败",icon:"none"})}finally{this.isLoading=!1}},distributeContent(){this.leftColumn=[],this.rightColumn=[],this.currentContent.forEach(((e,t)=>{t%2==0?this.leftColumn.push(e):this.rightColumn.push(e)}))}}};if(!Array){(e.resolveComponent("home-poster")+e.resolveComponent("tab-bar"))()}const i=e._export_sfc(s,[["render",function(t,s,i,a,o,r){return e.e({a:r.userAvatarUrl,b:e.o(((...e)=>r.handleAvatarError&&r.handleAvatarError(...e))),c:e.o(((...e)=>r.handleAvatarClick&&r.handleAvatarClick(...e))),d:e.t(o.userInfo.nickname),e:r.editIconUrl,f:e.o(((...e)=>r.handleEditProfile&&r.handleEditProfile(...e))),g:e.t(o.userInfo.bio||"点击添加个人介绍..."),h:e.o(((...e)=>r.handleEditBio&&r.handleEditBio(...e))),i:e.t(o.userInfo.postsCount),j:e.t(o.userInfo.likesCount),k:e.t(o.userInfo.level),l:e.f(o.achievements,((t,s,i)=>({a:r.getOSSUrl(t.icon),b:e.t(t.name),c:t.id}))),m:"posts"===o.activeTab?1:"",n:e.o((e=>r.switchTab("posts"))),o:"likes"===o.activeTab?1:"",p:e.o((e=>r.switchTab("likes"))),q:"records"===o.activeTab?1:"",r:e.o((e=>r.switchTab("records"))),s:o.isLoading},o.isLoading?{}:0===r.currentContent.length?{v:e.t("posts"===o.activeTab?"还没有发布过内容~":"likes"===o.activeTab?"还没有点赞过内容~":"还没有识别过哦~")}:{w:e.f(o.leftColumn,((t,s,i)=>({a:t.id,b:"de18fb73-0-"+i,c:e.p({"poster-data":t})}))),x:e.f(o.rightColumn,((t,s,i)=>({a:t.id,b:"de18fb73-1-"+i,c:e.p({"poster-data":t})})))},{t:0===r.currentContent.length})}],["__scopeId","data-v-de18fb73"]]);wx.createPage(i);
