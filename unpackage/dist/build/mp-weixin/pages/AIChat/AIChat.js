"use strict";const e=require("../../common/vendor.js"),t={__name:"AIChat",setup(t){const i=e.ref(""),a=e.ref([]),n=e.ref(!0),s=e.ref(!1),o=e.ref(0),c=e.ref(!1),l=e.ref(!1),r=e.ref(!1),u=e.ref(!1),d=e.ref("正在录音..."),v=e.ref([]),p="https://birdfront-oss.oss-cn-shanghai.aliyuncs.com",g=(e,t="icon")=>{if(!e)return"";const i=e.startsWith("/")?e.slice(1):e;let a="";switch(t){case"icon":default:a="?x-oss-process=image/resize,m_lfit,w_48,h_48/quality,q_90";break;case"small-icon":a="?x-oss-process=image/resize,m_lfit,w_32,h_32/quality,q_90";break;case"avatar":a="?x-oss-process=image/resize,m_lfit,w_80,h_80/quality,q_90";break;case"large":a="?x-oss-process=image/resize,m_lfit,w_120,h_120/quality,q_90";break;case"medium":a="?x-oss-process=image/resize,m_lfit,w_60,h_60/quality,q_90"}return`${p}/${i}${a}`},h=e.ref([{id:1,text:"鸟类识别",icon:"static/icons/identify.png"},{id:2,text:"鸟类习性",icon:"static/icons/behavior.png"},{id:3,text:"观鸟指南",icon:"static/icons/guide.png"},{id:4,text:"保护知识",icon:"static/icons/protection.png"}]),m=e.computed((()=>i.value.trim().length>0&&!s.value)),x=()=>{e.index.navigateBack()},w=()=>{e.index.showActionSheet({itemList:["清空聊天记录","导出聊天记录","设置"],success:e=>{switch(e.tapIndex){case 0:P();break;case 1:j();break;case 2:B()}}})},f=()=>{},y=()=>{l.value=!0,S()},_=()=>{l.value=!1},T=()=>{c.value&&C()},k=async()=>{if(!m.value)return;const t={id:Date.now(),type:"user",content:i.value.trim(),timestamp:new Date};a.value.push(t);const n=i.value.trim();i.value="",await e.nextTick$1(),S(),await D(n)},b=()=>{r.value=!0,u.value=!0,d.value="正在录音..."},$=()=>{r.value=!1,u.value=!1},q=()=>{r.value=!1,u.value=!1},I=()=>{e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{L(e.tempFilePaths[0])}})},D=async t=>{try{const i={id:Date.now()+1,type:"ai",content:"",timestamp:new Date,isTyping:!0};a.value.push(i),s.value=!0,await e.nextTick$1(),S(),await new Promise((e=>setTimeout(e,1500)));const n=await A(t),o=a.value.findIndex((e=>e.id===i.id));-1!==o&&(a.value[o].content=n,a.value[o].isTyping=!1,s.value=!1),M(n),await e.nextTick$1(),S()}catch(i){console.error("AI响应失败:",i);const t=a.value.findIndex((e=>e.id===aiMessage.id));-1!==t&&a.value.splice(t,1),s.value=!1,e.index.showToast({title:"AI响应失败，请重试",icon:"error"})}},A=async e=>{const t={"鸟类识别":"我可以帮您识别鸟类！请描述一下鸟的特征，比如大小、颜色、叫声等，或者您可以上传照片让我来识别。","鸟类习性":"不同鸟类有着各自独特的习性。您想了解哪种鸟类的习性呢？比如觅食习惯、繁殖行为、迁徙路线等。","观鸟指南":"观鸟是一项很有趣的活动！建议选择清晨或傍晚时间，准备好双筒望远镜，选择公园、湿地等鸟类活动频繁的地方。保持安静，避免惊扰鸟类。","保护知识":"鸟类保护非常重要。我们可以通过保护栖息地、减少污染、不干扰繁殖等方式来保护鸟类。您想了解具体哪个方面的保护知识呢？"};for(const[i,a]of Object.entries(t))if(e.includes(i))return a;return"这是一个很好的问题！作为鸟类专家，我很乐意为您解答。您能提供更多具体信息吗？这样我可以给出更准确的回答。"},M=e=>{const t=[{id:1,text:"告诉我更多"},{id:2,text:"有相关图片吗？"},{id:3,text:"谢谢"}];e.includes("识别")?v.value=[{id:1,text:"上传照片识别"},{id:2,text:"描述特征识别"},{id:3,text:"常见鸟类有哪些？"}]:e.includes("保护")?v.value=[{id:1,text:"如何参与保护？"},{id:2,text:"濒危鸟类有哪些？"},{id:3,text:"保护法律法规"}]:v.value=t,setTimeout((()=>{v.value=[]}),3e3)},L=async t=>{try{e.index.showLoading({title:"识别中..."}),await new Promise((e=>setTimeout(e,2e3))),e.index.hideLoading();const t="根据图片分析，这可能是一只麻雀。麻雀是常见的小型鸟类，体长约14-15厘米...",i={id:Date.now(),type:"ai",content:`图片识别结果：\n\n${t}`,timestamp:new Date,isTyping:!1};a.value.push(i),await e.nextTick$1(),S()}catch(i){e.index.hideLoading(),console.error("图片识别失败:",i),e.index.showToast({title:"识别失败，请重试",icon:"error"})}},S=()=>{setTimeout((()=>{o.value=99999}),100)},z=e=>{const t=new Date,i=new Date(e),a=t-i;return a<6e4?"刚刚":a<36e5?`${Math.floor(a/6e4)}分钟前`:a<864e5?`${Math.floor(a/36e5)}小时前`:`${i.getMonth()+1}/${i.getDate()} ${i.getHours()}:${i.getMinutes().toString().padStart(2,"0")}`},C=async()=>{try{console.log("加载更多消息")}catch(e){console.error("加载更多消息失败:",e)}},P=()=>{e.index.showModal({title:"确认清空",content:"确定要清空所有聊天记录吗？",success:t=>{t.confirm&&(a.value=[],e.index.showToast({title:"已清空",icon:"success"}))}})},j=()=>{e.index.showToast({title:"导出功能开发中",icon:"none"})},B=()=>{e.index.navigateTo({url:"/pages/ChatSettings/ChatSettings"})},F=e=>{console.warn("图标加载失败:",e)};return e.onMounted((()=>{console.log("AI聊天页面初始化"),n.value=!0})),e.watch(a,(()=>{e.nextTick$1((()=>{S()}))}),{deep:!0}),(t,l)=>e.e({a:g("static/icons/back.png","icon"),b:e.o(F),c:e.o(x),d:g("static/icons/ai-avatar.png","avatar"),e:e.o(F),f:n.value?1:"",g:s.value?1:"",h:e.t(s.value?"正在输入...":n.value?"在线":"离线"),i:g("static/icons/menu.png","icon"),j:e.o(F),k:e.o(w),l:0===a.value.length},0===a.value.length?{m:g("static/icons/ai-welcome.png","large"),n:e.o(F),o:e.f(h.value,((t,a,n)=>({a:g(t.icon,"icon"),b:e.o(F,t.id),c:e.t(t.text),d:t.id,e:e.o((e=>(e=>{i.value=e.text,k()})(t)),t.id)})))}:{},{p:e.f(a.value,((t,i,a)=>{return e.e({a:"ai"===t.type},"ai"===t.type?e.e({b:g("static/icons/ai-avatar.png","avatar"),c:e.o(F,t.id),d:t.isTyping},t.isTyping?{}:{e:(n=t.content,n.split("\n").map((e=>({name:"div",children:[{type:"text",text:e}]}))))},{f:!t.isTyping},t.isTyping?{}:{g:g("static/icons/copy.png","small-icon"),h:e.o(F,t.id),i:e.o((i=>(t=>{e.index.setClipboardData({data:t.content,success:()=>{e.index.showToast({title:"已复制",icon:"success"})}})})(t)),t.id),j:g(t.isLiked?"static/icons/like-filled.png":"static/icons/like.png","small-icon"),k:e.o(F,t.id),l:e.o((i=>(t=>{t.isLiked=!t.isLiked,e.index.vibrateShort()})(t)),t.id),m:g("static/icons/share.png","small-icon"),n:e.o(F,t.id),o:e.o((t=>{e.index.showShareMenu({title:"分享AI回答",path:"/pages/AIChat/AIChat"})}),t.id)},{p:e.t(z(t.timestamp))}):{q:e.t(t.content),r:e.t(z(t.timestamp)),s:g("static/icons/user-avatar.png","avatar"),t:e.o(F,t.id)},{v:t.id,w:"user"===t.type?1:"",x:"ai"===t.type?1:"",y:.1*i+"s"});var n})),q:c.value},c.value?{r:g("static/icons/loading.png","small-icon"),s:e.o(F),t:e.o(C)}:{},{v:o.value,w:e.o(T),x:v.value.length>0},v.value.length>0?{y:e.f(v.value,((t,a,n)=>({a:e.t(t.text),b:t.id,c:e.o((e=>(e=>{i.value=e.text,k()})(t)),t.id)})))}:{},{z:g("static/icons/voice.png","icon"),A:e.o(F),B:e.o(b),C:g("static/icons/image.png","icon"),D:e.o(F),E:e.o(I),F:e.o([e=>i.value=e.detail.value,f]),G:e.o(y),H:e.o(_),I:e.o(k),J:i.value,K:g(m.value?"static/icons/send-active.png":"static/icons/send.png","icon"),L:e.o(F),M:m.value?1:"",N:e.o(k),O:i.value.length>0},i.value.length>0?{P:e.t(i.value.length)}:{},{Q:r.value},r.value?{R:u.value?1:"",S:g("static/icons/microphone.png","large"),T:e.o(F),U:e.t(d.value),V:e.o($),W:e.o(q)}:{})}},i=e._export_sfc(t,[["__scopeId","data-v-ea5e20e9"]]);wx.createPage(i);
