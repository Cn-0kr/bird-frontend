"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),i={__name:"AIChat",setup(i){const a=e.ref(""),n=e.ref([]),s=e.ref(!0),o=e.ref(!1),c=e.ref(0),l=e.ref(!1),u=e.ref(!1),r=e.ref(!1),d=e.ref(!1),v=e.ref("正在录音..."),p=e.ref([]),m=e.ref([{id:1,text:"鸟类识别",icon:"/static/icons/identify.png"},{id:2,text:"鸟类习性",icon:"/static/icons/behavior.png"},{id:3,text:"观鸟指南",icon:"/static/icons/guide.png"},{id:4,text:"保护知识",icon:"/static/icons/protection.png"}]),g=e.computed((()=>a.value.trim().length>0&&!o.value)),x=()=>{e.index.navigateBack()},h=()=>{e.index.showActionSheet({itemList:["清空聊天记录","导出聊天记录","设置"],success:e=>{switch(e.tapIndex){case 0:q();break;case 1:P();break;case 2:z()}}})},w=()=>{},f=()=>{u.value=!0,C()},_=()=>{u.value=!1},y=()=>{l.value&&j()},T=async()=>{if(!g.value)return;const t={id:Date.now(),type:"user",content:a.value.trim(),timestamp:new Date};n.value.push(t);const i=a.value.trim();a.value="",await e.nextTick$1(),C(),await D(i)},$=()=>{r.value=!0,d.value=!0,v.value="正在录音..."},k=()=>{r.value=!1,d.value=!1},I=()=>{r.value=!1,d.value=!1},b=()=>{e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{L(e.tempFilePaths[0])}})},D=async t=>{try{const i={id:Date.now()+1,type:"ai",content:"",timestamp:new Date,isTyping:!0};n.value.push(i),o.value=!0,await e.nextTick$1(),C(),await new Promise((e=>setTimeout(e,1500)));const a=await A(t),s=n.value.findIndex((e=>e.id===i.id));-1!==s&&(n.value[s].content=a,n.value[s].isTyping=!1,o.value=!1),M(a),await e.nextTick$1(),C()}catch(i){console.error("AI响应失败:",i);const t=n.value.findIndex((e=>e.id===aiMessage.id));-1!==t&&n.value.splice(t,1),o.value=!1,e.index.showToast({title:"AI响应失败，请重试",icon:"error"})}},A=async e=>{const t={"鸟类识别":"我可以帮您识别鸟类！请描述一下鸟的特征，比如大小、颜色、叫声等，或者您可以上传照片让我来识别。","鸟类习性":"不同鸟类有着各自独特的习性。您想了解哪种鸟类的习性呢？比如觅食习惯、繁殖行为、迁徙路线等。","观鸟指南":"观鸟是一项很有趣的活动！建议选择清晨或傍晚时间，准备好双筒望远镜，选择公园、湿地等鸟类活动频繁的地方。保持安静，避免惊扰鸟类。","保护知识":"鸟类保护非常重要。我们可以通过保护栖息地、减少污染、不干扰繁殖等方式来保护鸟类。您想了解具体哪个方面的保护知识呢？"};for(const[i,a]of Object.entries(t))if(e.includes(i))return a;return"这是一个很好的问题！作为鸟类专家，我很乐意为您解答。您能提供更多具体信息吗？这样我可以给出更准确的回答。"},M=e=>{const t=[{id:1,text:"告诉我更多"},{id:2,text:"有相关图片吗？"},{id:3,text:"谢谢"}];e.includes("识别")?p.value=[{id:1,text:"上传照片识别"},{id:2,text:"描述特征识别"},{id:3,text:"常见鸟类有哪些？"}]:e.includes("保护")?p.value=[{id:1,text:"如何参与保护？"},{id:2,text:"濒危鸟类有哪些？"},{id:3,text:"保护法律法规"}]:p.value=t,setTimeout((()=>{p.value=[]}),3e3)},L=async t=>{try{e.index.showLoading({title:"识别中..."}),await new Promise((e=>setTimeout(e,2e3))),e.index.hideLoading();const t="根据图片分析，这可能是一只麻雀。麻雀是常见的小型鸟类，体长约14-15厘米...",i={id:Date.now(),type:"ai",content:`图片识别结果：\n\n${t}`,timestamp:new Date,isTyping:!1};n.value.push(i),await e.nextTick$1(),C()}catch(i){e.index.hideLoading(),console.error("图片识别失败:",i),e.index.showToast({title:"识别失败，请重试",icon:"error"})}},C=()=>{setTimeout((()=>{c.value=99999}),100)},S=e=>{const t=new Date,i=new Date(e),a=t-i;return a<6e4?"刚刚":a<36e5?`${Math.floor(a/6e4)}分钟前`:a<864e5?`${Math.floor(a/36e5)}小时前`:`${i.getMonth()+1}/${i.getDate()} ${i.getHours()}:${i.getMinutes().toString().padStart(2,"0")}`},j=async()=>{try{console.log("加载更多消息")}catch(e){console.error("加载更多消息失败:",e)}},q=()=>{e.index.showModal({title:"确认清空",content:"确定要清空所有聊天记录吗？",success:t=>{t.confirm&&(n.value=[],e.index.showToast({title:"已清空",icon:"success"}))}})},P=()=>{e.index.showToast({title:"导出功能开发中",icon:"none"})},z=()=>{e.index.navigateTo({url:"/pages/ChatSettings/ChatSettings"})};return e.onMounted((()=>{console.log("AI聊天页面初始化"),s.value=!0})),e.watch(n,(()=>{e.nextTick$1((()=>{C()}))}),{deep:!0}),(i,u)=>e.e({a:t._imports_0$1,b:e.o(x),c:t._imports_1$3,d:s.value?1:"",e:o.value?1:"",f:e.t(o.value?"正在输入...":s.value?"在线":"离线"),g:t._imports_2$2,h:e.o(h),i:0===n.value.length},0===n.value.length?{j:t._imports_3$2,k:e.f(m.value,((t,i,n)=>({a:t.icon,b:e.t(t.text),c:t.id,d:e.o((e=>(e=>{a.value=e.text,T()})(t)),t.id)})))}:{},{l:e.f(n.value,((i,a,n)=>{return e.e({a:"ai"===i.type},"ai"===i.type?e.e({b:t._imports_1$3,c:i.isTyping},i.isTyping?{}:{d:(s=i.content,s.split("\n").map((e=>({name:"div",children:[{type:"text",text:e}]}))))},{e:!i.isTyping},i.isTyping?{}:{f:t._imports_4$2,g:e.o((t=>(t=>{e.index.setClipboardData({data:t.content,success:()=>{e.index.showToast({title:"已复制",icon:"success"})}})})(i)),i.id),h:i.isLiked?"/static/icons/like-filled.png":"/static/icons/like.png",i:e.o((t=>(t=>{t.isLiked=!t.isLiked,e.index.vibrateShort()})(i)),i.id),j:t._imports_5$2,k:e.o((t=>{e.index.showShareMenu({title:"分享AI回答",path:"/pages/AIChat/AIChat"})}),i.id)},{l:e.t(S(i.timestamp))}):{m:e.t(i.content),n:e.t(S(i.timestamp)),o:t._imports_6$2},{p:i.id,q:"user"===i.type?1:"",r:"ai"===i.type?1:"",s:.1*a+"s"});var s})),m:l.value},l.value?{n:t._imports_7$1,o:e.o(j)}:{},{p:c.value,q:e.o(y),r:p.value.length>0},p.value.length>0?{s:e.f(p.value,((t,i,n)=>({a:e.t(t.text),b:t.id,c:e.o((e=>(e=>{a.value=e.text,T()})(t)),t.id)})))}:{},{t:t._imports_8,v:e.o($),w:t._imports_9,x:e.o(b),y:e.o([e=>a.value=e.detail.value,w]),z:e.o(f),A:e.o(_),B:e.o(T),C:a.value,D:g.value?"/static/icons/send-active.png":"/static/icons/send.png",E:g.value?1:"",F:e.o(T),G:a.value.length>0},a.value.length>0?{H:e.t(a.value.length)}:{},{I:r.value},r.value?{J:d.value?1:"",K:t._imports_10,L:e.t(v.value),M:e.o(k),N:e.o(I)}:{})}},a=e._export_sfc(i,[["__scopeId","data-v-3a9e6f18"]]);wx.createPage(a);
